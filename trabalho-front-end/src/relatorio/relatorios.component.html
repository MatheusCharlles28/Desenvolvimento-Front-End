<div class="relatorios-container">
<h2>Relatórios Financeiros</h2>

<div class="resumo-rapido">
  <div class="card-info">
    <h3>Média Mensal de Despesas</h3>
    <span class="valor-destaque">{{ formatarValor(mediaDespesasMensal) }}</span>
    <p class="descricao">Baseado nos últimos meses cadastrados</p>
  </div>

  <div class="card-info" *ngIf="categoriaMaiorGasto">
    <h3>Categoria com Maior Gasto</h3>
    <span class="categoria-destaque">{{ categoriaMaiorGasto.categoria | titlecase }}</span>
    <p class="descricao">{{ categoriaMaiorGasto.percentual | number:'1.1-1' }}% do total</p>
  </div>

  <div class="card-info" *ngIf="mesMaiorSaldo">
    <h3>Melhor Mês</h3>
    <span class="mes-destaque">{{ formatarMesAnoExibicao(mesMaiorSaldo.mes) }}</span>
    <p class="descricao">Saldo: {{ formatarValor(mesMaiorSaldo.saldo) }}</p>
  </div>
</div>

<div class="secao-relatorio">
  <h3>Saldo Mensal</h3>
  <div class="saldos-mensais">
    <div *ngFor="let s of saldosMensais" class="card-saldo">
      <div class="mes-titulo">{{ formatarMesAnoExibicao(s.mes) }}</div>
      <div class="valores-mes">
        <div class="item-valor receitas">
          <span class="label">Receitas:</span>
          <span class="valor">{{ formatarValor(s.receitas) }}</span>
        </div>
        <div class="item-valor despesas">
          <span class="label">Despesas:</span>
          <span class="valor">{{ formatarValor(s.despesas) }}</span>
        </div>
        <div class="divisor"></div>
        <div class="item-valor saldo" [ngClass]="obterCorSaldo(s.saldo)">
          <span class="label">Saldo:</span>
          <span class="valor-saldo">{{ formatarValor(s.saldo) }}</span>
        </div>
      </div>
    </div>
  </div>
  <div class="vazio" *ngIf="saldosMensais.length === 0">
    <p>Nenhum dado disponível para exibir o saldo mensal.</p>
  </div>
</div>

<div class="secao-relatorio">
  <h3>Distribuição de Despesas por Categoria</h3>
  <div class="categorias-percentual">
    <div *ngFor="let cat of categoriasPercentual" class="item-categoria">
      <div class="categoria-info">
        <div class="categoria-nome">
          <span class="nome">{{ cat.categoria | titlecase }}</span>
          <span class="percentual">{{ cat.percentual | number:'1.1-1' }}%</span>
        </div>
        <div class="categoria-valor">{{ formatarValor(cat.valor) }}</div>
      </div>
      <div class="barra-progresso">
        <div class="barra-preenchida"
             [style.width.%]="cat.percentual"
             [style.backgroundColor]="obterCorBarra(cat.percentual)">
        </div>
      </div>
    </div>
  </div>
  <div class="vazio" *ngIf="categoriasPercentual.length === 0">
    <p>Nenhuma despesa cadastrada para análise por categoria.</p>
  </div>
</div>

<div class="secao-relatorio">
  <h3>Análises Detalhadas</h3>
  <div class="analises-grid">
    <div class="card-analise">
      <h4>Resumo Geral</h4>
      <div class="analise-item">
        <span class="label">Total de Receitas:</span>
        <span class="valor positivo">{{ formatarValor(totalReceitas) }}</span>
      </div>
      <div class="analise-item">
        <span class="label">Total de Despesas:</span>
        <span class="valor negativo">{{ formatarValor(totalDespesas) }}</span>
      </div>
      <div class="analise-item destaque">
        <span class="label">Saldo Total:</span>
        <span class="valor" [ngClass]="obterCorSaldo(saldoTotal)">
          {{ formatarValor(saldoTotal) }}
        </span>
      </div>
    </div>

    <div class="card-analise">
      <h4>Informações dos Meses</h4>
      <div class="analise-item" *ngIf="mesMaiorSaldo">
        <span class="label">Melhor Mês:</span>
        <span class="valor positivo">{{ formatarMesAnoExibicao(mesMaiorSaldo.mes) }}</span>
      </div>
      <div class="analise-item" *ngIf="mesMenorSaldo">
        <span class="label">Pior Mês:</span>
        <span class="valor negativo">{{ formatarMesAnoExibicao(mesMenorSaldo.mes) }}</span>
      </div>
      <div class="analise-item">
        <span class="label">Meses Analisados:</span>
        <span class="valor neutro">{{ saldosMensais.length }}</span>
      </div>
    </div>

    <div class="card-analise" *ngIf="categoriasPercentual.length > 0">
      <h4>Análise de Categorias</h4>
      <div class="analise-item">
        <span class="label">Categoria Principal:</span>
        <span class="valor destaque">{{ categoriaMaiorGasto?.categoria | titlecase }}</span>
      </div>
      <div class="analise-item">
        <span class="label">Participação:</span>
        <span class="valor neutro">{{ categoriaMaiorGasto?.percentual | number:'1.1-1' }}%</span>
      </div>
      <div class="analise-item">
        <span class="label">Categorias Diferentes:</span>
        <span class="valor neutro">{{ categoriasPercentual.length }}</span>
      </div>
    </div>
  </div>
</div>
</div>
